/*! Localization Tool - v0.0.14 - 2015-02-03
* http://darksmo.github.io/jquery-localization-tool/
* Copyright (c) 2015; Licensed MIT */
!function(a){var b=!1,c={_languageCodeToOrdinal:function(b){var c=this,d=c.data("activeLanguageCodeArray"),e=a.inArray(b,d);return-1===e&&a.error("Cannot convert "+b+" into an ordinal number"),e},_ordinalToLanguageCode:function(b){var c=this,d=c.data("activeLanguageCodeArray");return(d.length<=b||0>b)&&a.error("Cannot convert "+b+" into a language code."),d[b]},_languageCodeToHtml:function(a){var b=this,c=b.data("settings"),d=c.languages,e=d[a],f="";e.flag.hasOwnProperty("class")&&(f=" "+e.flag["class"]);var g="";e.flag.hasOwnProperty("url")&&(g='<img src="'+e.flag.url+'" />');var h=e.language,i=e.country,j=[];return j.push('<li class="ltool-language ',a,'">'),c.showFlag&&(j.push('<div class="ltool-language-flag',f,'"></div>'),j.push(g)),c.showCountry&&j.push(['<span class="ltool-language-country">',i,"</span>"].join("")),c.showLanguage&&j.push(['<span class="ltool-language-name">',h,"</span>"].join("")),j.push("</li>"),j.join("")},_selectLanguage:function(b){var c=this;c.find(".ltool-dropdown-label").html(a(".ltool-language."+b).html()),c.data("selectedLanguageCode",b)},_initializeWidget:function(b){var d=this,e=d.data("settings"),f=e.languages,g=[];g.push('<span tabindex="0" class="ltool-dropdown-label">Change Language</span><div class="ltool-dropdown-label-arrow"></div>'),g.push('<ul class="ltool-dropdown-items">');var h,i;for(i=0;h=b[i++];)f.hasOwnProperty(h)?g.push(c._languageCodeToHtml.call(d,h)):a.error("The language '"+h+"' must be defined");return g.push("</ul>"),a(g.join("")).appendTo(d),d},_onDropdownClicked:function(){var a=this,b=a.data("selectedLanguageCode");return a.find(".ltool-language").removeClass("ltool-is-selected"),a.find("."+b).addClass("ltool-is-selected"),a.toggleClass("ltool-is-visible"),a},_closeDropdown:function(){var a=this;a.removeClass("ltool-is-visible")},_onMouseout:function(a){var b=this;return b.find(a.relatedTarget).length>0?(b.find(".ltool-is-selected").removeClass("ltool-is-selected"),a.preventDefault(),b):void b.removeClass("ltool-is-visible")},_onLanguageSelected:function(a){var b=this,d=a.attr("class").replace("ltool-language","").replace("ltool-is-selected","").replace(/ /g,"");c._selectLanguage.call(b,d),c._mayTranslate.call(b,d)},_selectPreviousLanguage:function(){var a=this,b=a.data("selectedLanguageCode"),d=c._languageCodeToOrdinal.call(a,b);if(0!==d){var e=c._ordinalToLanguageCode.call(a,d-1);return a.find(".ltool-is-selected").removeClass("ltool-is-selected"),c._selectLanguage.call(a,e),c._mayTranslate.call(a,e),a.find("."+e).addClass("ltool-is-selected"),a}},_selectNextLanguage:function(){var a=this,b=a.data("activeLanguageCodeArray"),d=a.data("selectedLanguageCode"),e=c._languageCodeToOrdinal.call(a,d);if(!(e+1>=b.length)){var f=c._ordinalToLanguageCode.call(a,e+1);return a.find(".ltool-is-selected").removeClass("ltool-is-selected"),c._selectLanguage.call(a,f),c._mayTranslate.call(a,f),a.find("."+f).addClass("ltool-is-selected"),a}},_onKeydown:function(a){var b=this;switch(a.keyCode){case 13:c._onDropdownClicked.call(b),a.preventDefault();break;case 40:c._selectNextLanguage.call(b),a.preventDefault();break;case 38:c._selectPreviousLanguage.call(b),a.preventDefault();break;case 27:c._closeDropdown.call(b),a.preventDefault()}return b},_bindEvents:function(){var d=this;return d.bind("mousedown.localizationTool",function(a){b=!1,c._onKeydown.call(d,a)}).bind("click.localizationTool",function(a){c._onDropdownClicked.call(d,a)}).bind("keydown.localizationTool",function(a){b=!0,c._onKeydown.call(d,a)}).bind("mouseout.localizationTool",function(a){c._onMouseout.call(d,a)}).bind("focusout.localizationTool",function(){b&&c._closeDropdown.call(d)}),d.find(".ltool-language").bind("click.localizationTool",function(){c._onLanguageSelected.call(d,a(this))}),d},_decomposeStringsForReferenceMapping:function(){var a,b={idStrings:[],classStrings:[],elementStrings:[],textStrings:[],attributeStrings:[]},c=this,d=c.data("settings").strings,e=new RegExp("^[a-zA-Z-]+?::");for(a in d)d.hasOwnProperty(a)&&(a.match(e)?b.attributeStrings.push(a):0===a.indexOf("id:")?b.idStrings.push(a):0===a.indexOf("class:")?b.classStrings.push(a):0===a.indexOf("element:")?b.elementStrings.push(a):b.textStrings.push(a));return b},_buildStringReferenceMapping:function(){var b,d,e=this,f={},g=e.data("settings"),h=g.strings,i=c._decomposeStringsForReferenceMapping.call(e);for(d=0;b=i.idStrings[d++];){var j=b.substring("id:".length),k=a("#"+j),l=k.contents();(g.ignoreUnmatchedSelectors!==!0||0!==l.length)&&(1!==l.length?a.error(b+" must contain exactly one text node, found "+l.length+" instead"):3!==l[0].nodeType?a.error(b+" does not contain a #text node (i.e., type 3)"):f[b]={isAttribute:!1,originalText:k.text(),domNodes:[k]})}var m=function(b,c,e,g){var j,k=b.replace(":","");for(d=0;j=i[k+"Strings"][d++];){var l,m=j.substring(b.length),n=[],o=!0;l=void 0;var p,q=0;a:for(;p=a(c+m)[q++];){var r=a(p);if(e){var s=r.attr("id");if("string"==typeof s&&h.hasOwnProperty("id:"+s))continue a}if(g){var t=r.attr("class");if("string"==typeof t)for(var u,v=t.split(" "),w=0;u=v[w++];)if("string"==typeof u&&h.hasOwnProperty("class:"+u))continue a}var x=r.contents();0===x.length||x.length>1?a.error("A '"+j+"' node was found to contain "+x.length+" child nodes. This node must contain exactly one text node!"):3===x[0].nodeType?(n.push(r),"undefined"==typeof l?l=r.text():l!==r.text()&&(o=!1)):a.error("A '"+j+"' node does not contain a #text node (i.e., type 3)")}o?f[j]={isAttribute:!1,originalText:l,domNodes:n}:a.error("Not all text content of elements with "+j+" were found to be '"+l+"'. So these elements will be ignored.")}};m("class:",".",!0,!1),m("element:","",!0,!0);var n,o=new RegExp("(class|id|element):[^:]");for(d=0;n=i.attributeStrings[d++];){var p=n.split("::"),q=p.shift();0===p.length&&a.error("sorry, you need to specify class:, element: or id: selectors in "+n);var r=p.join("::");p[0].match(o)||a.error(n+"Doesn't look right. Perhaps you've added extra semicolons?"),r=r.replace("id:","#"),r=r.replace("class:","."),r=r.replace("element:","");var s=a(r+"["+q+"]");0===s.length&&a.error('The selector "'+n+'" does not point to an existing DOM element');var t=0,u=!0,v=a(s[0]).attr(q),w=[];for(t=0;t<s.length;t++){var x=a(s[t]);v!==x.attr(q)&&(u=!1),w.push(x)}u||a.error("Not all the attribute values selected via "+n+" are the same"),f[n]={isAttribute:!0,originalText:v,domNodes:w}}var y;for(d=0;y=i.textStrings[d++];){var z,A,B=[],C=a(":contains("+y+")");for(z=0;A=C[z++];){var D=a(A).contents();1===D.length&&3===D[0].nodeType&&B.push(a(A))}B.length>0&&(f[y]={isAttribute:!1,originalText:y,domNodes:B})}return e.data("refMappingObj",f),e},_mayTranslate:function(a){var b=this,d=b.data("settings");!1!==d.onLanguageSelected(a)&&c._translate.call(b,a)},getSelectedLanguageCode:function(){var a=this;return a.data("selectedLanguageCode")},_translate:function(b){var c=this,d=c.data("settings"),e=d.strings,f=c.data("refMappingObj"),g="ltr";if("undefined"!=typeof b){if(!d.languages.hasOwnProperty(b))return a.error("The language code "+b+" is not defined"),c;d.languages[b].hasOwnProperty("cssDirection")&&(g=d.languages[b].cssDirection)}var h;for(h in f)if(f.hasOwnProperty(h)){var i;i="undefined"==typeof b||b===d.defaultLanguage?f[h].originalText:e[h][b];var j,k,l=f[h].domNodes;if(f[h].isAttribute===!0){var m=h.split("::",1)[0];for(k=0;j=l[k++];)j.attr(m,i),j.css("direction",g)}else for(k=0;j=l[k++];)j.html(i),j.css("direction",g)}return c},translate:function(a){var b=this;return c._translate.call(b,a),c._selectLanguage.call(b,a),b},destroy:function(){var b=this;return b.removeData(),b.unbind("click.localizationTool",function(a){c._onDropdownClicked.call(b,a)}),b.find(".ltool-language").unbind("click.localizationTool",function(){c._onLanguageSelected.call(b,a(this))}),b.unbind("mouseout.localizationTool",function(a){c._onMouseout.call(b,a)}),b.empty(),b},_findSubsetOfUsedLanguages:function(b){var c,d=this,e=d.data("settings"),f={},g=0;for(c in b)if(b.hasOwnProperty(c)){var h,i=b[c];for(h in i)i.hasOwnProperty(h)&&(f.hasOwnProperty(h)||(f[h]=0)),f[h]++;g++}var j,k=[];for(j in f)f.hasOwnProperty(j)&&f[j]===g&&k.push(j);var l=a.inArray(e.defaultLanguage,k);return l>-1&&k.splice(l,1),k.unshift(e.defaultLanguage),k.sort(function(a,b){return e.languages[a].country.localeCompare(e.languages[b].country)}),k},init:function(b){var d={en_GB:{country:"United Kingdom",language:"English",countryTranslated:"United Kingdom",languageTranslated:"English",flag:{"class":"flag flag-gb"}},de_DE:{country:"Germany",language:"German",countryTranslated:"Deutschland",languageTranslated:"Deutsch",flag:{"class":"flag flag-de"}},es_ES:{country:"Spain",language:"Spanish",countryTranslated:"España",languageTranslated:"Español",flag:{"class":"flag flag-es"}},fr_FR:{country:"France",language:"French",countryTranslated:"France",languageTranslated:"Français",flag:{"class":"flag flag-fr"}},pt_BR:{country:"Brazil",language:"Portuguese",countryTranslated:"Brasil",languageTranslated:"Português",flag:{"class":"flag flag-br"}},en_AU:{country:"Australia",language:"English",countryTranslated:"Australia",languageTranslated:"English",flag:{"class":"flag flag-au"}},en_IN:{country:"India",language:"English",countryTranslated:"India",languageTranslated:"English",flag:{"class":"flag flag-in"}},it_IT:{country:"Italy",language:"Italian",countryTranslated:"Italia",languageTranslated:"Italiano",flag:{"class":"flag flag-it"}},jp_JP:{country:"Japan",language:"Japanese",countryTranslated:"日本",languageTranslated:"日本語",flag:{"class":"flag flag-jp"}},ar_TN:{country:"Tunisia",language:"Arabic",countryTranslated:"تونس",languageTranslated:"عربي",cssDirection:"rtl",flag:{"class":"flag flag-tn"}},en_IE:{country:"Ireland",language:"English",countryTranslated:"Ireland",languageTranslated:"English",flag:{"class":"flag flag-ie"}},nl_NL:{country:"Netherlands",language:"Dutch",countryTranslated:"Nederland",languageTranslated:"Nederlands",flag:{"class":"flag flag-nl"}},zh_CN:{country:"China",language:"Chinese",countryTranslated:"中国",languageTranslated:"中文",flag:{"class":"flag flag-cn"}},fi_FI:{country:"Finland",language:"Finnish",countryTranslated:"Suomi",languageTranslated:"Suomi",flag:{"class":"flag flag-fi"}},pt_PT:{country:"Portugal",language:"Portuguese",countryTranslated:"Portugal",languageTranslated:"Português",flag:{"class":"flag flag-pt"}},pl_PL:{country:"Poland",language:"Polish",countryTranslated:"Polska",languageTranslated:"Polski",flag:{"class":"flag flag-pl"}},ru_RU:{country:"Russia",language:"Russian",languageTranslated:"Русский",countryTranslated:"Россия",flag:{"class":"flag flag-ru"}},hi_IN:{country:"India",language:"Hindi",countryTranslated:"भारत",languageTranslated:"हिन्द",flag:{"class":"flag flag-in"}},tr_TR:{country:"Turkey",language:"Turkish",countryTranslated:"Türkiye",languageTranslated:"Türkçe",flag:{"class":"flag flag-tr"}},he_IL:{country:"Israel",language:"Hebrew",countryTranslated:"מדינת ישראל",languageTranslated:"עברית",cssDirection:"rtl",flag:{"class":"flag flag-il"}},da_DK:{country:"Denmark",language:"Danish",countryTranslated:"Danmark",languageTranslated:"Dansk",flag:{"class":"flag flag-dk"}},eo:{language:"Esperanto",languageTranslated:"Esperanto",flag:{"class":"flag flag-esperanto"}}},e=a.extend({defaultLanguage:"en_GB",ignoreUnmatchedSelectors:!1,showFlag:!0,showLanguage:!0,showCountry:!0,languages:{},strings:{},onLanguageSelected:function(){return!0}},b);return e.languages=a.extend(d,e.languages),e.languages.hasOwnProperty(e.defaultLanguage)||a.error("FATAL: the default language "+e.defaultLanguage+" is not defined in the 'languages' parameter!"),this.each(function(){var b=a(this);b.data("settings",e);var d=c._findSubsetOfUsedLanguages.call(b,e.strings);b.data("activeLanguageCodeArray",d),c._initializeWidget.call(b,d),c._selectLanguage.call(b,e.defaultLanguage),c._bindEvents.call(b),c._buildStringReferenceMapping.call(b)})}},d="localizationTool";a.fn[d]=function(b){if(c[b]){if(this.data("initialized")===!0)return c[b].apply(this,Array.prototype.slice.call(arguments,1));throw new Error("method "+b+" called on an uninitialized instance of "+d)}return"object"!=typeof b&&b?void a.error("Cannot call method "+b):(this.data("initialized",!0),c.init.apply(this,arguments))}}(jQuery);